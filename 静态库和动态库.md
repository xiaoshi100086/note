# 说明

系统|静态库|动态库
---|---|---
window|*.lib|*.dll
linux|*.a|*.so

# 动态库的加载

使用命令`ldd your_bin_file`，可以看到可执行文件加载了那些动态库

使用命令`ldd -u your_bin_file`，可以看到那些动态库加载但没有使用

那些没有使用但通过gcc命令显式加载的动态库，默认并不会被编译器优化。程序启动时，会加载这些没有用的动态库。可以使用`-Wl,--as-needed`编译选项来显式进行编译优化。

# 动态库的查找

动态库默认查找路径：

1. 当前工作目录下查找
1. 编译目标代码时指定的动态库搜索路径
1. 环境变量`LD_LIBRARY_PATH`指定的动态库搜索路径
1. 配置文件`/etc/ld.so.conf`中指定的动态库搜索路径
1. 默认的动态库搜索路径`/lib`
1. 默认的动态库搜索路径`/usr/lib`

查找时机分为两种，一种是链接时候的搜索路径，一种是运行时期的搜索路径

1. 链接时搜索 搜索`gcc`命令中显式说明的动态库
2. 运行时搜索 对于`gcc`命令没有显式提到但使用的动态，会在程序运行时再次查找

如果需要加载其他文件夹的动态库

* 一种方式使用gcc命令显式指出，一般对本工程的动态库使用
* 一种是在`/etc/ld.so.conf`中，填写动态库所在路径，一个路径一行，一般对第三方的动态库使用。在修改`/etc/ld.so.conf`或者在默认路径中增加动态库时，需要使用命令`ldconfig `生效，ldconfig会把`/etc/ld.so.conf`的内容拷贝到缓存`/etc/ld.so.cache`中。
* 通过`export LD_LIBRARY_PATH=your_so_path`
·，修改环境变量`LD_LIBRARY_PATH`，增加动态库路径，但是只对本次shell有效。可以把命令写入`~/bashrc`或者`/etc/bashrc`文件，前者针对本用户的shell开始前加载运行，后者针对所有人的shell开始前加载运行。但是，有不少声音主张要避免使用 LD_LIBRARY_PATH 变量，尤其是作为全局变量。见http://xahlee.info/UnixResource_dir/_/ldpath.html
* 一种是直接拷贝库文件到默认查找路径下，这样会破坏原动态库的结构，不建议使用。
